<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/animate.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
    <link href="stylesheets/plugins/sweetalert/sweetalert.css" rel="stylesheet">

    <title>Home Page</title>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <style>
        body {
            padding: 0px;
            margin: 0;
            background: #ccc;
        }
        
        .box {
            width: 100%;
            height: 48px;
            display: block;
            background: #8c8c8c;
        }
        
        .container {
            display: block;
            max-width: 420px;
            margin: auto;
            padding: 0;

        }
        
        .header {
            display: inline-block;
            position: relative;
            width: 100%;
            background-image: url("<%= profileUrl %>");
            background-size: cover;
            background-position: 50% 50%;
        }
        
        .header .zhezhao .authorIMG {
            width: 60px;
            height: 60px;
            min-width: 60px;
            min-height: 60px;
            border-radius: 60px;
            margin: 55px auto 10px auto;
            display: block;
            /*border-color: #2da5ec;*/
            border-width: 8px;
            /*border-style: groove;*/
        }
        
        .zhezhao {
            position: absolute;
            top: 0;
            height: 240px;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .header .authorIcon {
            width: 12px;
            height: 12px;
        }
        
        .header span {
            color: #fff;
            font-size: 15px;
        }
        
        .name {
            margin-top: 134px;
            text-align: center;
        }
        
        .name img {
            background: #fff;
            border-radius: 50%;
        }
        
        .userInfoBox {
            display: box;
            /* OLD - Android 4.4- */
            display: -webkit-box;
            /* OLD - iOS 6-, Safari 3.1-6 */
            display: -moz-box;
            /* OLD - Firefox 19- (buggy but mostly works) */
            display: -ms-flexbox;
            /* TWEENER - IE 10 */
            display: -webkit-flex;
            display: flex;
            justify-content: space-between;
            -webkit-flex-direction: row;
            -moz-flex-direction: row;
            -ms-flex-direction: row;
            -o-flex-direction: row;
            flex-direction: row;
            align-items: center;
            color: #fff;
        }
        
        .userInfoBox span {
            font-size: 12px;
            text-align: center;
            flex: 1; 
            -webkit-box-flex: 1; 
            -moz-box-flex: 1; 
            -ms-flex: 1;
            -moz-flex-grow: 1;
            -webkit-flex-grow: 1;
            flex-grow: 1;
            flex-direction:'row'; 
            -webkit-box-direction: 'normal';
            -webkit-box-orient: 'horizontal';
            -moz-flex-direction: 'row';
            -webkit-flex-direction: 'row';
        }
        
        .tags {
            height: 44px;
            color: #666;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        
        .tags div {
            width: 100%;
            text-align: center;
            padding: 10px;
            background: #fff;
            border-bottom: 1px solid #ccc;
        }
        
        .pro_item {
            height: 90px;
            padding: 10px;
            margin-bottom: 5px;
            display: block;
            color: #666;
            border-bottom: 1px solid #e2e2e2;
            position: relative;
        }
        
        .pro_bottom_info {
            display: flex;
            position: absolute;
            bottom: 7px;
            left: 10px;
            right: 10px;
            flex-direction: row;
            justify-content: space-between;
        }
        
        .join {
            display: none;
        }
        
        .join_btn {
            text-decoration: none;
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .touchDiv {
            border-bottom: 1px solid #e2e2e2
        }
        
        .projectlist,
        #taskListgit {
            background: #fff;
        }
       
        .task-item {
            background: #ffe;
            color: 20px;
            font-family: "open sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
            min-height: 90px;
            border-bottom: 1px solid #fff;
            padding: 10px;
            font-size:15px ;

            
        }
        .task-item-light {
            background: #fff;
            color: 20px;
            font-family: "open sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
            min-height: 90px;
            border-bottom: 1px solid #CCC;
            padding:10px;
            font-size:15px ;

        }
        .over{
            width: 100%;
            height: 60px;
            border-bottom: 1px solid #ccc;
            text-align: center;
            font-size: 20px;
            background: #fff;
            line-height: 60px;
        }
        .row{
            margin:0;
        }
        .col-lg-12 {
            padding: 0;
        }
        .hasSelectProject{
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-12">
                <h2><%= nickName %></h2>
                <ol class="breadcrumb">
                    <li>
                        <span class="projectNameStr"><%= projectUniqNo ? 'My project: ' + projectName : 'You have not particiapted any project. Please choose one from the following projects.' %><span>
                    </li>
                </ol>
            </div>
        </div>
        <div class="wrapper wrapper-content">
            <!-- 没有加入项目 -->
            <div class="row animated fadeInRight hasNoproject">
                <% for( i= 0; i < projectList.length ;i++){ %>
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5><%=projectList[i].projectName%></h5>
                            <div class="ibox-tools">
                                <a data-toggle="collapse" data-target="#project<%=i%>" >
                                    <i class="fa fa-chevron-down"></i>
                                </a>
                            </div>
                        </div>
                        <div id="project<%=i%>" class="collapse">
                            <div class="ibox-content profile-content">
                                <h5><strong>Create Time</strong></h5>
                                <p><%=projectList[i].createTime%></p>
                                <h5>
                                    <strong>Project Description</strong>
                                </h5>
                                <p>
                                    <%=projectList[i].projectDesc%>
                                </p>
                                <div class="user-button">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <button type="button" class="btn btn-primary btn-sm btn-block isTure" data-account="<%=account%>" data-projectNo="<%=projectList[i].projectNo%>"> Join Project</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
            </div>
            <div class="row animated fadeInRight hasSelectProject">
            </div>

            <!-- 加入项目 -->

            <div class="row animated fadeInRight">
                <%if(userAllTaskList.length > 0 ) {%>
                    <div class="col-lg-12">
                        <div class="ibox">
                            <div class="ibox-content">
                                <h5>Project Completion Progress</h5>
                                <h2><%=progressRate%></h2>
                                <div class="progress progress-mini">
                                    <div style="width: <%=progressRate%>" class="progress-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <%for(var i = 0 ; i< userAllTaskList.length ; i++){ %>
                        <div class="col-lg-12">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>Task <%= i+1 %></h5>
                                    <div class="ibox-tools ">
                                        <a class="pull-right" data-toggle="collapse" data-target="#demo<%=i%>">
                                            <i class="fa fa-chevron-down"></i>
                                        </a>
                                        <%if(userAllTaskList[i].done){%>
                                         <label class="label label-primary pull-right">Completed</label>
                                        <% } else {%> 
                                         <label class="label label-warning pull-right">Pending</label>
                                        <%} %>
                                    </div>
                                </div>
                                <div id="demo<%=i%>" class="collapse">
                                    <div class="ibox-content profile-content">
                                        <h5>
                                            <%=userAllTaskList[i].chTitle%>
                                        </h5>
                                        <p>
                                            <%-userAllTaskList[i].chDesc%>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }%>
                    <div class="col-lg-12 ">
                        <h5 class="text-center">
                            No More Tasks
                        </h5> 
                        <button type="button" class="outProject btn btn-block btn-w-m btn-success" data-account="<%=account%>" data-projectUniqNo="<%=projectUniqNo%>">Quit Project</button>
                    </div>
                <% } %> 
            </div>
        </div>
    </div>
    
    <!-- Mainly scripts -->
        <script src="js/jquery-2.1.1.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

        <!-- Flot -->
        <script src="js/plugins/flot/jquery.flot.js"></script>
        <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
        <script src="js/plugins/flot/jquery.flot.spline.js"></script>
        <script src="js/plugins/flot/jquery.flot.resize.js"></script>
        <script src="js/plugins/flot/jquery.flot.pie.js"></script>
        <script src="js/plugins/flot/jquery.flot.symbol.js"></script>
        <script src="js/plugins/flot/curvedLines.js"></script>

        <!-- Peity -->
        <!-- <script src="js/plugins/peity/jquery.peity.min.js"></script> -->
        <!-- <script src="js/demo/peity-demo.js"></script> -->

        <!-- Custom and plugin javascript -->
        <script src="js/inspinia.js"></script>
        <script src="js/plugins/pace/pace.min.js"></script>

        <!-- jQuery UI -->
        <script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

        <!-- Jvectormap -->
        <script src="js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
        <script src="js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

        <!-- Sparkline -->
        <script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>

        <!-- Sparkline demo data  -->
        <script src="js/demo/sparkline-demo.js"></script>

        <!-- Sweet alert -->
        <script src="js/plugins/sweetalert/sweetalert.min.js"></script>


    <script>
        $(document).ready(function () {
            $('.isTure').click(function(){
                var account = $(this).attr('data-account')  
                var projectNo = $(this).attr('data-projectNo')
                console.log(account, projectNo)
                swal({
                    title: "Are you sure?",
                    text: "You can participate only one project at the same time.",
                    showCancelButton: true,
                    confirmButtonColor: "#AEDEF4",
                    confirmButtonText: "yes",
                    cancelButtonText:"no",
                    closeOnConfirm: true
                }, function(){
                    return JoinProject(account, projectNo)
                });
            });

            $('.outProject').click(function () {
                var account = $(this).attr('data-account')
                var projectUniqNo = $(this).attr('data-projectUniqNo') 
                swal({
                    title: "Are you sure?",
                    showCancelButton: true,
                    confirmButtonColor: "#AEDEF4",
                    confirmButtonText: "yes",
                    cancelButtonText:"no",
                    closeOnConfirm: true
                }, function(){
                    return cancel(account, projectUniqNo)
                })
            })

        })

        function JoinProject(account,projectNo) {
            $.get('/jionProject', {account:account,projectNo:projectNo}, function(e) {
                if (e.userAllTaskList && e.userAllTaskList.length > 0) {
                    $('.hasNoproject').hide()
                    $('.hasSelectProject').show()
                    $('.projectNameStr').text(e.projectName)
                    e.userAllTaskList.map(function(item, key){
                        var node = $('<div></div>')
                        node.addClass('col-lg-12')
                        var _html = ""
                        _html += '<div class="ibox float-e-margins">'
                        _html += '<div class="ibox-title">'
                        _html += '<h5>Task' + (key+1) + '</h5>'
                        _html += '<div class="ibox-tools">'
                        _html += '<a class="pull-right" data-toggle="collapse" data-target="#new'+ key +'">'
                        _html += '<i class="fa fa-chevron-down"></i>'
                        _html += '</a>'
                        _html += item.done ? '<label class="label label-primary pull-right">Completed</label>':'<label class="label label-warning pull-right">Pending</label>'
                        _html += '</div>'
                        _html += '</div>'
                        _html += '<div id="new'+ key +'" class="collapse">'
                        _html += '<div class="ibox-content profile-content">'
                        _html += '<h5>'
                        _html += item.chTitle
                        _html += '</h5>'
                        _html += '<p>'
                        _html += item.chDesc
                        _html += '</p>'
                        _html += '</div>'
                        _html += '</div>'
                        var ibox = $(_html)
                        ibox.appendTo(node)
                        node.appendTo($('.hasSelectProject'))
                    })
                }
            })
        }

        function cancel(account,projectNo){
            $.get('/cancelProject', {account: account, projectNo : projectNo}, function(e){
                WeixinJSBridge.invoke('closeWindow');
            })
        }
    </script>
</body>

</html>